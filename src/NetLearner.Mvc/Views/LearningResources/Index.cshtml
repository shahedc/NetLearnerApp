@model IEnumerable<NetLearner.SharedLib.Models.LearningResource>
@using System.Web
@{

    ViewData["Title"] = "Learning Resources";

    bool isVideo(string fullUrl)
    {
        if (fullUrl.Contains("youtube.com") || (fullUrl.Contains("youtu.be")))
        {
            return true;
        }
        else
            return false;
    }

}

<h1>Learning Resources</h1>

<p>
    <a asp-action="Create">Create New Learning Resource</a> |
    <a asp-area="" asp-controller="LearningResources" asp-action="Index">All Resources</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Name)
            </th>
            <th>
                Preview
            </th>
            <th>
                @Html.DisplayNameFor(model => model.ResourceList)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            string videoUrl = item.Url.Replace("/watch?v=", "/embed/");
            <tr>
                <td>
                    <a id="videolink_@item.Id"
                       href="@item.Url"
                       title="@item.Url">
                        @Html.DisplayFor(modelItem => item.Name)
                    </a>
                </td>
                <td>
                    <!-- Trigger/Open The Modal -->
                    @if (isVideo(item.Url))
                    {
                        <button id="myBtn_@item.Id"
                                onclick="launchModal('@item.Id', '@videoUrl')">
                            Watch
                        </button>
                    }
                    else
                    {
                        <a id="videolink_@item.Id"
                           href="@item.Url"
                           title="@item.Url">
                            Link
                        </a>
                    }
                    <!-- The Modal -->
                    <div id="myModal_@item.Id" class="modal">

                        <!-- Modal content -->
                        <div class="modal-content">
                            <span class="close" id="close_@item.Id"
                                  onclick="closeModal('@item.Id')">&times;</span>
                            <p id="video_@item.Id">
                                Video for @item.Url
                                @**@
                            </p>
                        </div>

                    </div>

                </td>
                <td>
                    <a href="/LearningResources/GetForList?Id=@item.ResourceListId">
                        @Html.DisplayFor(modelItem => item.ResourceList.Name)
                    </a>
                </td>
                <td>
                    <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                    <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                    <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                </td>
            </tr>
        }
    </tbody>
</table>

@{
  
}

@section Scripts {

<script>

    function launchModal(itemId, itemUrl) {
        videoFrame = '<iframe width="560" height="315" src="' + (itemUrl) + '" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';
    
        var videoPara = document.getElementById("video_" + itemId);
        videoPara.innerHTML = videoFrame;

        var modal = document.getElementById("myModal_" + itemId);
        modal.style.display = "block";
    }

    function closeModal(itemId) {
        var modal = document.getElementById("myModal_" + itemId);
        modal.style.display = "none";

        var videoPara = document.getElementById("video_" + itemId);
        videoPara.innerHTML = "";
    }
</script>
}


<style type="text/css">
    /* The Modal (background) */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 600px; /* 80%; */ /* Could be more or less, depending on screen size */
    }

    /* The Close Button */
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
</style>